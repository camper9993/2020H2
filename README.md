# Лабораторная 1 
## Инструкция по использованию
Потребуется kotlin компилятор, который можно скачать по  [ссылке](https://kotlinlang.org/docs/tutorials/command-line.html).

Запустить из консоли:

`kotlinc -script Server.kts`

`kotlinc -script Client.kts`

## Описание используемого протокола
Имеется два типа пакетов: отправляемые от клиентов серверу и от сервера клиентам.
Формат пакетов, отправляемых от клиентов серверу:

Length message | Time  | Message 
--|--|--


Формат пакетов, отправляемых от сервера клиентам:

Length message | Time  | Message | Length message | Name
--|--|--|--|--

По умолчанию сервер и клиент запускаются на адресе 127.0.0.1 и на порту - 9999, это можно изменить с помощью аргументов командной строки, как описано выше. 
Размеры Length message и Length name фиксированные – 1 байт. Там содержатся числа, закодированные в utf-8, - длина имени и сообщения. Соответственно, максимально возможная длина сообщения - 127 символов. Message, Time и Name тоже передаются в формате utf-8. В случае ввода сообщения или имени пользователя длиной больше, чем 127 символов, будут получены только первые 127, а остальное отброшено. Размер времени фиксирован, 5 байт, используется передача времени в 24 часовом формате разделенном двоеточием. 
Первым сообщением после установления соединения является отправка клиентом имени пользователя, которое сервер запоминает, после чего отправляются сами сообщения. Таким образом, имя пользователя в дальнейшем отправлять не приходится.
## Реализация 
Чат написан на kotlin. Расширение файлов - kts, Что позволяет запускать файлы написанные на котлине как скрипты. 
#### Сервер
При запуске сервера считываются аргументы командной строки, и создается объект класса java.net.ServerSocket, который слушает подключения клиентов. Когда клиент подключается, считывается первое сообщение от него - его имя. Клиент и его имя запоминается и запускается отдельный поток, который слушает сообщения от нового клиента. При получении последующих сообщений от клиента они пересылаются всем остальным клиентам, в сообщение сервером добавляется инфмормация о имени клиента. При отключении клиента, информация о нем удаляется. 
#### Клиент 
При запуске клиента также считываются аргументы командной строки, идет подключение к серверу. Если клиент подключился к серверу, считывается имя пользователя и отправляется на сервер. Запускается два потока: первый слушает сервер и выводит в консоль сообщения от сервера, второй слушает ввод пользователя и отправляет сообщения на сервер. При отключении сервера выводится сообщение `Server shutdown` и программа завершает свою работу. 
